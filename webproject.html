<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
    <style>
        h1{
            text-align:center;
        }
        p{
            text-align: center;
        }
        h2{
            margin: 0;
           
        }
        .box{
            border: 1px solid gray;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        span{
             border: 1px solid blue;
            border-radius: 3px; 
            padding: 3px;
            margin: 3px;
            background-color: lightblue;
        }
    </style>
    <script>
        //=============================================================================
        function gid(id) {return document.getElementById(id);}
        //=============================================================================
        function spanClickHandler(){
            let parentID = this.parentNode.getAttribute('id'); //Node.Id
            if(parentID == 'listDone')
                gid("listToDo").appendChild(this);
            else
                gid("listDone").appendChild(this);
            saveClickHandler();
                
        };
        //=============================================================================
        function keydownHandler(){
            if(event.keyCode == 13){
                pushTokenToBox(this.value, "listToDo");
                //입력 영역 clear
                this.value ="";
                saveClickHandler();
            }
        }
        //=============================================================================
        //=============================================================================
        function pushTokenToBox(strToken, boxName){
            let newItem = document.createElement("span");
                newItem.innerHTML = strToken;
            $(newItem).addClass("badge");
            $(newItem).addClass("bg-success");
            $(newItem).click(spanClickHandler);
            gid(boxName).appendChild(newItem);
        }
        //=============================================================================
        function getTokenStringFromBox(boxName){
            let box = {
                itemString: [],
                boxName: boxName
            }
            let spanArray = gid(boxName).querySelectorAll("span");
            for(let span of spanArray)
                box.itemString.push(span.innerHTML);
            return JSON.stringify(box);
        }
        //=============================================================================
        function saveClickHandler(){
            localStorage.setItem("listToDo", getTokenStringFromBox("listToDo"));
            localStorage.setItem("listDone", getTokenStringFromBox("listDone"));
            console.log("Saved.");
        }
        //=============================================================================
        function restoreTokenList(){
            let check = localStorage.getItem("listToDo");
            if(check == null)   return;
            let listToDo = JSON.parse(check);
            let listDone = JSON.parse(localStorage.getItem("listDone"));
            for(let token of listToDo.itemString)
                pushTokenToBox(token, listToDo.boxName);
            for(let token of listDone.itemString)
                pushTokenToBox(token, listDone.boxName);
        }

        $(document).ready(function(){
            $("#newItem").keydown(keydownHandler);
            restoreTokenList();
        });
        
        
    </script>
</head>
<body>
    <h1>TODo List Project Management System</h1>
    <p>/ 2021-2학기 / 웹개발기초ll 기말과제 / 동의과학대학교 컴퓨터정보과 / 현재윤 /</p>
    <hr>
    New: <input type="text" id="newItem" size="50">
    <button id="saveTokenList">추가</button>
    <hr>
    <h2>ToDo list</h2>
    <div class="box" id="listToDo">

    </div>
    <h2>Done list</h2>
    <div class="box" id="listDone"></div>
</body>
</html>